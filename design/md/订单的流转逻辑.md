# 撮合流程核心描述

## 订单的流转逻辑

1. 订单接收与分类
    - 接收用户订单后持久化存储至MySQL
    - 通过KFK将订单发送至撮合服务
2. 撮合服务处理逻辑
    - 消费KFK订单消息，解析订单类型(市价/限价)和方向(买/卖)
    - 市价单:
        - 市价买单 → 放入市价买单队列（内存队列）
        - 市价卖单 → 放入市价卖单队列
    - 限价单：
        - 检查撮合引擎状态
        - 引擎关闭 → 写入订单簿（Redis ZSet）
        - 引擎开启 → 进入撮合流程
3. 撮合执行：
    - 价格匹配检查
    - 生成交易记录对象
    - 更新订单簿
    - 通过KFK发送交易记录至市场服务
    - 更新市场单队列
    - 通过KFK发送完成订单记录至市场服务

4. 市场服务后续处理：
    - 接收交易记录结果
        - 推送最近20条成交记录
        - 推送订单薄
        - 推送当前币种交易对详情
        - 处理K线图，推送K线图数据
    - 接受完成订单记录
        - 更新用户资产




